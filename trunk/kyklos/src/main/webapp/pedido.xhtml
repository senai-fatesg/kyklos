<?xml version="1.0" encoding="utf-8" ?>
<ui:composition template="template.xhtml" xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets"
   xmlns:a="http://www.ambientinformatica.com.br/jsf2" xmlns:p="http://primefaces.org/ui">

   <ui:define name="corpo">

	<p:panel header="Pedido">
      <div class="screenHeader">

         <a:field spaceLeft="1%">
            <p:panelGrid id="gridTop" styleClass="form-group">
               <p:row>
                  <p:column>
                     <p:commandButton title="Limpar Tela" value="limpar" type="reset" icon="ui-icon-trash" />
                  </p:column>
                  <p:column>
                     <p:commandButton title="Consultar Pedidos" value="Buscar" icon="ui-icon-search" onclick="document.location.href='pedidoLista.xhtml'" />
                  </p:column>
                  <p:column>
                     <p:commandButton title="Salvar Pedido" value="Salvar" actionListener="#{NegociacaoPedidoControl.salvarPedido}" icon="ui-icon-disk" />
                  </p:column>
                  
               </p:row>
            </p:panelGrid>
         </a:field>

      </div>

      <div class="contentField">
         <p:panelGrid id="pedidoGrid" class="semBorda" style="width:100%; background-color:#F9FAFB">
            <p:row>
               <p:column style="width: 26% !important;">
                  <p:autoComplete id="consultarCliente" size="20" dropdown="false" converter="objectConverter" value="#{NegociacaoPedidoControl.negociacaoPedido.cliente}" var="c" itemValue="#{c}"
                     itemLabel="#{c.nome}" completeMethod="#{NegociacaoPedidoControl.completeCliente}" placeholder="Adicionar Cliente (Nome)" minQueryLength="2" style="width: 100% !important;"
                     inputStyle="width: 100% !important; text-align: center;">
                     <p:ajax event="itemSelect" update="formCorpo" />

                     <p:column>
                        <p:outputLabel value="#{c.id} - #{c.nome}" />
                     </p:column>

                  </p:autoComplete>
               </p:column>

               <p:column style="width:2% !important;">
                  <p:commandButton styleClass="addButton" id="addClienteButton" onclick="PF('dialogCadastroRapidoCliente').show();"
                     actionListener="#{NegociacaoPedidoControl.limparClienteCadastroRapido}" icon="ui-icon-plusthick" />
               </p:column>

               <p:column styleClass="pedInfoLabel">
                  <p:outputLabel for="clienteOutput" value="Cliente:" style="font-weight: bold;" />
               </p:column>

               <p:column styleClass="pedInfo">
                  <h:outputText id="clienteOutput" value="#{NegociacaoPedidoControl.negociacaoPedido.cliente.nome}" />
               </p:column>

               <p:column styleClass="pedInfoLabel">
                  <p:outputLabel for="numeroPedido" value="Nº: " style="font-weight: bold;" />
               </p:column>

               <p:column>
                  <h:outputText id="numeroPedido" value="#{NegociacaoPedidoControl.pedido.numero}" />
               </p:column>

            </p:row>
            <p:row>
               <p:column>
                  <p:autoComplete id="consultarVendedor" size="20" dropdown="false" converter="objectConverter" value="#{NegociacaoPedidoControl.vendedor}" var="v" itemValue="#{v}"
                     itemLabel="#{v.pessoa.nome}" completeMethod="#{NegociacaoPedidoControl.completeVendedor}" placeholder="Vendedor (Nome)" style="width: 100% !important;"
                     inputStyle="width: 100% !important; text-align: center; align: left;">

                     <p:ajax event="itemSelect" update="formCorpo" />

                     <p:column>
                        <p:outputLabel value="#{v.id} - #{v.pessoa.nome}" />
                     </p:column>

                  </p:autoComplete>
               </p:column>

               <p:column style="width:2% !important;">

               </p:column>

               <p:column styleClass="pedInfoLabel">
                  <p:outputLabel for="vendedorOutput" value="Vendedor:" style="font-weight: bold;" />
               </p:column>

               <p:column styleClass="pedInfo">
                  <h:outputText id="vendedorOutput" value="#{NegociacaoPedidoControl.vendedor.pessoa.nome}" />
               </p:column>

               <p:column styleClass="pedInfoLabel">
                  <p:outputLabel for="dataEmissao" value="Emissão:" style="font-weight: bold;" />
               </p:column>

               <p:column>
                  <h:outputText id="dataEmissao" value="#{NegociacaoPedidoControl.pedido.data}">
                     <f:convertDateTime pattern="dd/MM/yy" />
                  </h:outputText>
               </p:column>
            </p:row>

            <p:row>
               <p:column>
                  <p:autoComplete id="consultarProduto1" size="20" dropdown="false" converter="objectConverter" value="#{NegociacaoPedidoControl.produto}" var="p" itemValue="#{p}"
                     itemLabel="#{p.descricao}" completeMethod="#{NegociacaoPedidoControl.completeProduto}" placeholder="Adicionar Produto (Nome/Código)" minQueryLength="3"
                     style="width: 100% !important;" inputStyle="width: 100% !important; text-align: center; align: left;">

                     <p:ajax event="itemSelect" update="formCorpo" listener="#{NegociacaoPedidoControl.selecionarProduto}" oncomplete="PF('formProdutoNegocio').show();" />

                     <p:column>
                        <p:outputLabel value="#{p.codigo} - #{p.descricao}" />
                     </p:column>

                  </p:autoComplete>
               </p:column>

               <p:column style="width:2% !important;">

               </p:column>

               <p:column styleClass="pedInfoLabel">
               </p:column>

               <p:column styleClass="pedInfo">
               </p:column>

               <p:column styleClass="pedInfoLabel">
                  <p:outputLabel for="statusPedido" value="Status:" style="font-weight: bold;" />
               </p:column>

               <p:column>
                  <h:outputText id="statusPedido" value="#{NegociacaoPedidoControl.pedido.status}" />
               </p:column>
               
               
               
                
            </p:row>

            <p:row>
               <p:column colspan="10">
                  <p:tabView id="pedidoTab" class="semBorda" dynamic="true" cache="true" value="#{NegociacaoPedidoControl.negociacaoPedido.pedidos}" var="pedido" styleClass="tabViewStyle">

                     <p:ajax event="tabClose" oncomplete="PF('confirmarRemoverPedido').show();" update="formCorpo" />

                     <p:tab title="#{pedido.empresa.pessoa.nome}" closable="false">
                        <p:dataTable id="itemTable" value="#{pedido.itens}" var="item" rowIndexVar="rowIndex">

                           <p:column width="8%" headerText="Nº" styleClass="d">
                              <h:outputText value="#{rowIndex + 1}" />
                           </p:column>

                           <p:column width="10%" styleClass="e" headerText="Código">
                              <h:outputText value="#{item.produto.codigo}" />
                           </p:column>

                           <p:column styleClass="e" headerText="Descrição">
                              <h:outputText value="#{item.produto.descricao}" />
                           </p:column>

                           <p:column width="9%" styleClass="d" headerText="Valor Unitário">
                              <h:outputText value="#{item.valorUnitario}">
                                 <f:convertNumber pattern="###,##0.00" />
                              </h:outputText>
                           </p:column>

                           <p:column width="8%" styleClass="d" headerText="Qtd.">
                              <h:outputText value="#{item.quantidade}">
                                 <f:convertNumber pattern="###,##0.####" />
                              </h:outputText>
                           </p:column>

                           <p:column width="8%" styleClass="d" headerText="Total">
                              <h:outputText value="#{item.valorTotal}">
                                 <f:convertNumber pattern="###,##0.00" />
                              </h:outputText>
                           </p:column>

                           <p:column width="8%" headerText="Opções" rendered="#{NegociacaoPedidoControl.pedido.status == 'ABERTO'}">
                              <p:commandButton id="editButton" class="tableButton" icon="ui-icon-pencil" action="#{NegociacaoPedidoControl.editarProduto}" oncomplete="PF('formProdutoNegocio').show();"
                                 update=":formCorpo:formProdutoNegocio">
                                 <f:setPropertyActionListener value="#{item}" target="#{NegociacaoPedidoControl.item}"></f:setPropertyActionListener>
                              </p:commandButton>

                              <p:commandButton id="delButton" class="tableButton" icon="ui-icon-trash" oncomplete="PF('confirmarRemoverItem').show();">
                                 <f:setPropertyActionListener value="#{item}" target="#{NegociacaoPedidoControl.item}"></f:setPropertyActionListener>
                              </p:commandButton>
                           </p:column>
                        </p:dataTable>
                        <p:confirmDialog header="Confirmação" message="Deseja realmente remover este pedido?" severity="alert" widgetVar="confirmarRemoverPedido" resizable="false">

                           <p:commandButton id="simButton1" value="Sim" actionListener="#{NegociacaoPedidoControl.removerProduto}" onclick="PF('confirmarRemoverPedido').hide();"
                              styleClass="ui-confirmdialog-yes" update=":formCorpo:pedidoTab" icon="ui-icon-check">
                              <f:param name="pedidoAExcluir" value="#{pedido}"></f:param>

                           </p:commandButton>

                           <p:commandButton id="naoButton1" value="Não" onclick="PF('confirmarRemoverPedido').hide();" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />

                        </p:confirmDialog>
                     </p:tab>
                  </p:tabView>

               </p:column>
            </p:row>

         </p:panelGrid>

         <a:newLine />

         <p:confirmDialog header="Confirmação" message="Deseja realmente excluir este produto do pedido?" severity="alert" widgetVar="confirmarRemoverItem" resizable="false">

            <p:commandButton id="simButton2" value="Sim" actionListener="#{NegociacaoPedidoControl.removerProduto()}" onclick="PF('confirmarRemoverItem').hide();" styleClass="ui-confirmdialog-yes"
               update="@all" icon="ui-icon-check">
               <f:setPropertyActionListener value="#{pedido}" target="NegociacaoPedidoControl.pedidoExcluir"></f:setPropertyActionListener>
            </p:commandButton>

            <p:commandButton id="naoButton2" value="Não" onclick="PF('confirmarRemoverItem').hide();" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />

         </p:confirmDialog>

      </div>

      <p:dialog id="formProdutoNegocio" header="Tela de Produto" widgetVar="formProdutoNegocio" showEffect="puff" hideEffect="scale" resizable="false" height="50%" width="50%">
         <h:panelGroup id="formProduto">

            <div id="topMenu" align="center">
               <p:commandButton value="Adicionar" actionListener="#{NegociacaoPedidoControl.adicionarProduto}" update="@all" icon="ui-icon-plusthick"
                  rendered="#{not NegociacaoPedidoControl.modoEdicao}" onclick="PF('formProdutoNegocio').hide();">
               </p:commandButton>

               <p:commandButton value="Salvar" actionListener="#{NegociacaoPedidoControl.salvarPedido}" update=":formCorpo:pedidoTab" icon="ui-icon-disk">
               </p:commandButton>

               <p:commandButton value="Cancelar" update=":formCorpo:pedidoTab" type="reset" icon="ui-icon-cancel" onclick="PF('formProdutoNegocio').hide();" />
            </div>

            <a:newLine />
            <p:panelGrid styleClass="semBorda">
               <p:row>
                  <p:column>
                     <h:outputLabel for="produtoDescricao" value="Descrição: ">
                        <h:outputText id="produtoDescricao" value="#{NegociacaoPedidoControl.item.produto.descricao}" />
                     </h:outputLabel>
                     <a:newLine />
                     <a:newLine />
                     <h:outputLabel for="produtoCodigo" value="Código: ">
                        <h:outputText id="produtoCodigo" value="#{NegociacaoPedidoControl.item.produto.codigo}" />
                     </h:outputLabel>
                  </p:column>
                  <p:column style="width:65%;">
                     <p:dataTable id="selecionarEstoque" var="e" value="#{NegociacaoPedidoControl.listaEstoque}" converter="objectConverter" selection="#{NegociacaoPedidoControl.estoqueSelecionado}"
                        rowKey="#{e.estoque}" style="margin-bottom:0">

                        <f:facet name="header">
                           <h:outputText value="Estoque" />
                        </f:facet>

                        <p:column selectionMode="multiple" style="width:16px;text-align:center" />

                        <p:column headerText="Estoque">
                           <h:outputText value="#{e.estoque.descricao}" />
                        </p:column>

                        <p:column headerText="Qtd.">
                           <p:panelGrid class="semBorda">
                              <p:column>
                                 <h:outputText value="#{e.quantidade}" />
                              </p:column>
                              <p:column>
                                 <p:inputText id="inputQuantidade" class="inputText" placeholder="Qtd" onfocus="" value="#{e.quantidadeSelecionada}" style="width:100% !important; text-align: center;" />
                              </p:column>
                           </p:panelGrid>
                        </p:column>
                     </p:dataTable>
                  </p:column>
               </p:row>
               <p:row>
                  <p:column colspan="2" style="padding:0px;">
                     <p:panel header="Estoques Externos" toggleable="true" rendered="#{NegociacaoPedidoControl.gridEstoqueExterno}" collapsed="true" id="panelEstoqueExterno" widgetVar="estoqueExterno"
                        toggleOrientation="vertical" style="border:none !important;">
                        <p:dataTable id="selecionarEstoqueExterno" var="est" value="#{NegociacaoPedidoControl.listaEstoqueExterno}" converter="objectConverter"
                           selection="#{NegociacaoPedidoControl.estoqueExternoSelecionado}" rowKey="#{est.estoque}" style="margin-bottom:0; width:100%;">

                           <p:column selectionMode="multiple" style="width:16px;text-align:center" />

                           <p:column headerText="Estoque">
                              <h:outputText value="#{est.estoque.descricao}" />
                           </p:column>

                           <p:column headerText="Quantidade">
                              <p:panelGrid class="semBorda">
                                 <p:column>
                                    <h:outputText value="#{est.quantidade}" />
                                 </p:column>
                                 <p:column>
                                    <p:inputText id="inputQuantidade2" placeholder="Qtd" value="#{est.quantidadeSelecionada}" style="width:100% !important; text-align: center;" />
                                 </p:column>
                              </p:panelGrid>
                           </p:column>

                           <p:column headerText="Local (CNPJ)">
                              <h:outputText value="#{est.estoque.pessoaEmpresa.pessoa.nome} (#{est.estoque.pessoaEmpresa.pessoa.cpfCnpj})" />
                           </p:column>
                        </p:dataTable>
                     </p:panel>
                  </p:column>
               </p:row>

            </p:panelGrid>

            <div id="fieldValores">
               <p:panelGrid columns="4" cellpadding="1" style="width:100%;">
                  <h:outputLabel for="OutputValorUnitario" value="Valor Un.">
                     <a:newLine />
                     <h:outputText id="OutputValorUnitario" class="outputText" value="#{NegociacaoPedidoControl.item.valorUnitario}">
                        <f:convertNumber pattern="###,##0.00" />
                     </h:outputText>
                  </h:outputLabel>

                  <h:outputLabel for="OutputValorTotal" value="Total">
                     <a:newLine />
                     <h:outputText id="OutputValorTotal" class="outputText">
                        <f:convertNumber pattern="###,##0.00" />
                     </h:outputText>
                  </h:outputLabel>

                  <h:outputLabel for="InputDesconto" value="Desconto">
                     <a:newLine />
                     <p:inputText id="InputDesconto" class="inputText" placeholder="0" />
                     <h:outputText id="percentage" value="%" />
                  </h:outputLabel>
               </p:panelGrid>
            </div>

         </h:panelGroup>

      </p:dialog>

      <p:dialog widgetVar="dialogCadastroRapidoCliente" id="dialogCadastroRapidoCliente" closable="false" resizable="false" header="Cadastro Rápido de Cliente">
         <div id="topMenu" align="center">
            <a:field spaceLeft="1%">
               <p:panelGrid id="gridTopDialog" styleClass="semBorda">
                  <p:row>
                     <p:column>
                        <p:commandButton value="Cancelar" onclick="PF('formCadastroRapidoCliente').hide();" icon="ui-icon-cancel"/>
                     </p:column>
                     <p:column>
                        <p:commandButton value="Limpar" type="reset" actionListener="#{NegociacaoPedidoControl.limparClienteCadastroRapido}" />
                     </p:column>
                     <p:column>
                        <p:commandButton value="Cadastrar" actionListener="#{NegociacaoPedidoControl.salvarCliente}" oncomplete="PF('dialogCadastroRapidoCliente').hide();" />
                     </p:column>
                  </p:row>
               </p:panelGrid>
            </a:field>
         </div>
         <a:newLine />
         <p:panelGrid id="panelCadastroRapidoCliente" styleClass="semBorda">
            <p:row>
               <p:column styleClass="d">
                  <h:outputText value="CPF/CNPJ: " />
               </p:column>
               <p:column colspan="3" styleClass="e">
                  <p:inputText title="CPF/CNPJ" placeholder="CPF/CNPJ" value="#{NegociacaoPedidoControl.cliente.cpfCnpj}" />
               </p:column>
            </p:row>
            <p:row>
               <p:column styleClass="d">
                  <h:outputText value="Nome / Razão Social: " />
               </p:column>
               <p:column colspan="3" styleClass="e">
                  <p:inputText title="Nome / Razão Social" placeholder="Nome / Razão Social" value="#{NegociacaoPedidoControl.cliente.nome}" />
               </p:column>
            </p:row>
            <p:row>
               <p:column styleClass="c" colspan="5">
                  <h:outputText value="*Cadastro deve ser completado posteriormente*" style="color:#716E69;" />
               </p:column>
            </p:row>

         </p:panelGrid>
      </p:dialog>

	</p:panel>
   </ui:define>

</ui:composition>